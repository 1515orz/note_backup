# nmap命令

    Nmap,也就是Network Mapper,最早是Linux下的网络扫描和嗅探工具包 
    其基本功能有三个,一是探测一组主机是否在线其次是扫描主机端口,嗅探所提供的网络服务, 还可以推断主机所用的操作系统
    Nmap可用于扫描仅有两个节点的LAN,直至500个节点以上的网络 Nmap 还允许用户定制扫描技巧
    通常,一个简单的使用ICMP协议的ping操作可以满足一般需求
    也可以深入探测UDP或者TCP端口, 直至主机所使用的操作系统, 还可以将所有探测结果记录到各种格式的日志中, 供进一步分析操作 
    
进行ping扫描，打印出对扫描做出响应的主机,不做进一步测试(如端口扫描或者操作系统探测)：
> nmap -sP 192.168.1.0/24

仅列出指定网络上的每台主机，不发送任何报文到目标主机：
> nmap -sL 192.168.1.0/24

探测目标主机开放的端口，可以指定一个以逗号分隔的端口列表(如-PS22，23，25，80)：
> nmap -PS 192.168.1.234

使用UDP ping探测主机：
> nmap -PU 192.168.1.0/24

    使用频率最高的扫描选项: SYN扫描,又称为半开放扫描, 它不打开一个完全的TCP连接,执行得很快:
nmap -sS 192.168.1.0/24

当SYN扫描不能用时，TCP Connect()扫描就是默认的TCP扫描：
> nmap -sT 192.168.1.0/24

UDP扫描用-sU选项,UDP扫描发送空的(没有数据)UDP报头到每个目标端口:
> nmap -sU 192.168.1.0/24

确定目标机支持哪些IP协议 (TCP，ICMP，IGMP等):
> nmap -sO 192.168.1.19

探测目标主机的操作系统:
>nmap -O 192.168.1.19
>nmap -A 192.168.1.19

---

## nmap示例

扫描单个目标地址
> Nmap 192.168.128.30

扫描多个目标地
> Nmap 192.168.128.130 192.168.128.129

扫描一个范围内的目标地址
>Nmap 192.168.128.129-130

扫描目标地址所在的某个网段
> Nmap 192.168.128.130/24

扫描主机列表1.txt
> Nmap -iL C:\Users\1.txt

扫描除某一目标地址之外的所有目标地址
> Nmap 192.168.128.100/24 -exclude 192.168.128.130

扫描除某一文件中的目标地址之外的目标地址
> Nmap 192.168.128.100/24 -excludefile C:\Users\1.txt

扫描某一目标地址的21、22、23、80端口
> Nmap 192.168.128.130 -p 21,22,23,80

对目标地址进行路由追踪

> Nmap --traceroute 192.168.128.130

>  扫描目标地址所在C段（同一网段）的在线情况

Nmap -sP 192.168.128.130/24

>  目标地址的操作系统指纹识别

Nmap -O 192.168.128.130

>  目标地址提供服务的版本检测

Nmap -sV 192.168.128.130

>  探测防火墙状态

Nmap -sF -T4 192.168.128.130

>  鉴权扫描

使用--script=auth可以对目标主机或目标主机所在的网段进行应用弱口令检测 

Nmap --script=auth 192.168.128.130

>  暴力破解攻击

Nmap具有暴力破解的功能,可对数据库,smb、snmp等进行简单密码的暴力猜解 

Nmap --script=brute 192.168.128.130

>  扫描常见漏洞

Nmap具有漏洞扫描的功能,可以检查目标主机或网段是否存在常见的漏洞 

Nmap --script=vuln 192.168.128.130

>  应用服务扫描

Nmap具有很多常见应用服务的扫描脚本,例如vnc服务、mysql服务、Telnet服务、rsync服务等,此处以vnc服务为例 

Nmap --script=realvnc-auth-bypass 192.168.128.130

>   探测局域网内更多服务开启的情况

Nmap -n -p 445 --script=broadcast 192.168.0.105

>  Whois解析

Nmap -script external baidu.com

---

`nmap -v scanme`
> 这个选项扫描主机scanme中 所有的保留TCP端口。选项-v启用细节模式。

`nmap -sS -O scanme./24`
> 进行秘密SYN扫描，对象为主机Scanme所在的“C类”网段 的255台主机。同时尝试确定每台工作主机的操作系统类型。因为进行SYN扫描 和操作系统检测，这个扫描需要有根权限。

`nmap -sV -p 22，53，110，143，4564 188.116.0-255.1-127`
> 进行主机列举和TCP扫描，对象为B类188.116网段中255个8位子网。这 个测试用于确定系统是否运行了sshd、DNS、imapd或4564端口。如果这些端口 打开，将使用版本检测来确定哪种应用在运行。

`nmap -v -iR 100000 -P0 -p 80`
> 随机选择100000台主机扫描是否运行Web服务器(80端口)。由起始阶段 发送探测报文来确定主机是否工作非常浪费时间，而且只需探测主机的一个端口，因 此使用-P0禁t止对主机列表。

`nmap -P0 -p80 -oX logs/pb-port80scan.xml -oG logs/pb-port80scan.gnmap 216.163.128.20/20`
> 扫描4096个IP地址，查找Web服务器(不ping)，将结果以Grep和XML格式保存。

`host -l | cut -d -f 4 | nmap -v -iL -`
>进行DNS区域传输，以发现中的主机，然后将IP地址提供给 Nmap。上述命令用于GNU/Linux -- 其它系统进行区域传输时有不同的命令。

---

### 状态识别

* Open: 开放的,表示应用程序正在监听该端口的连接,外部可以访问
* Filtered: 被过滤的,表示端口被防火墙或其他网络设备阻止,不能访问
* Closed: 关闭的,表示目标主机未开启该端口
*  Unfiltered: 未被过滤的,表示Nmap无法确定端口所处状态,需进一步探测
* Open/Filtered: 开放的或被过滤的,Nmap不能识别
* Closed/Filtered: 关闭的或未被过滤的,Nmap不能识别
